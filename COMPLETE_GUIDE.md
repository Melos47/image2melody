# 🎵 Image2Melody - 完整使用指南

## 📖 目录

1. [快速开始](#快速开始)
2. [声音设置](#声音设置)
3. [使用方法](#使用方法)
4. [HSV色彩模型](#hsv色彩模型)
5. [保存功能](#保存功能)
6. [键盘控制](#键盘控制)
7. [常见问题](#常见问题)

---

## 🚀 快速开始

### 1. 启动程序

```bash
cd /Users/siqi/Documents/PolyU/Sem1/SD5913/image2melody
source venv/bin/activate
python main.py
```

### 2. 检查MIDI设备

如果看到警告窗口或控制台显示：
```
✗ No MIDI output device found
```

**立即执行**: [声音设置](#声音设置)

### 3. 加载图片并生成音乐

- 点击 **[LOAD IMAGE]**
- 选择图片文件
- 点击 **[START ANIMATION]**
- 享受音乐！🎵

---

## 🔊 声音设置

### ⚠️ 重要：首次使用必须设置

macOS需要配置MIDI输出设备才能听到声音。

### 🎹 推荐方案：SimpleSynth

**1. 下载SimpleSynth**
- 访问: https://notahat.com/simplesynth/
- 下载并安装到Applications文件夹

**2. 启动SimpleSynth**
```bash
open -a SimpleSynth
```

**3. 验证设置**
```bash
source venv/bin/activate
python test_midi.py
```

应该看到：✓ 设备已找到

**4. 运行程序**
```bash
python main.py
```

✅ 现在可以听到声音了！

### 备选方案：IAC Driver

见 `SOUND_SETUP_GUIDE.md` 详细步骤

---

## 🎮 使用方法

### 步骤1：加载图片

1. 启动程序后，点击中央的 **[LOAD IMAGE]** 按钮
2. 选择图片文件（支持PNG、JPG、BMP、GIF）

**推荐图片类型：**
- ✅ 像素艺术
- ✅ 鲜艳的卡通图案
- ✅ 纯色几何图形
- ✅ 渐变色背景
- ❌ 复杂照片（颜色太多）

### 步骤2：确认开始

- 弹出窗口显示图片信息
- 点击 **[START ANIMATION]** 开始
- 或点击 **[CANCEL]** 取消

### 步骤3：观看动画+聆听音乐

- 🎨 像素块逐个显示（从左到右，从上到下）
- 🎵 每个像素块播放对应的音符
- 📊 状态栏显示进度和RGB信息
- 🎹 可随时使用键盘控制

### 步骤4：保存旋律

动画完成后：
- 点击 **[SAVE MIDI]** 保存为MIDI文件
- 点击 **[LOAD NEW]** 加载新图片

---

## 🎨 HSV色彩模型

### 什么是HSV？

- **H (Hue/色相)**: 颜色类型（红、橙、黄、绿、青、蓝、紫）
- **S (Saturation/饱和度)**: 颜色纯度（鲜艳vs灰暗）
- **V (Value/明度)**: 颜色亮度（明亮vs黑暗）

### 音符映射

| HSV参数 | 影响 | 效果 |
|---------|------|------|
| **色相 (H)** | 音高 | 色轮循环 → 五声音阶 (C,D,E,G,A) |
| **明度 (V)** | 八度+时长 | 亮=高音+长音符，暗=低音+短音符 |
| **饱和度 (S)** | 音量 | 鲜艳=强音量，灰=弱音量 |
| **透明度 (A)** | 额外音量 | 透明度越高，音量越小 |

### 示例

**鲜红色** RGB(255,0,0)
```
→ HSV(0.0, 1.0, 1.0)
→ 音符：高音C，1/4拍，强音量
```

**天蓝色** RGB(135,206,235)
```
→ HSV(0.55, 0.43, 0.92)
→ 音符：高音A，1/4拍，中音量
```

**深绿色** RGB(0,100,0)
```
→ HSV(0.33, 1.0, 0.39)
→ 音符：低音E，1/16拍，强音量
```

详见：`HSV_MELODY_GUIDE.md`

---

## 💾 保存功能

### 保存MIDI文件

1. 动画完成后，点击 **[SAVE MIDI]**
2. 选择保存位置和文件名
3. 文件保存为 `.mid` 格式

### MIDI文件用途

保存的MIDI文件可以：
- ✅ 在GarageBand中编辑
- ✅ 在Logic Pro中打开
- ✅ 在任何MIDI播放器中播放
- ✅ 导入到其他音乐制作软件

### 文件包含

- 所有播放的音符
- 音高、时长、力度信息
- 标准MIDI格式
- 8-bit音色设置（Square Lead）

---

## 🎹 键盘控制

### 实时控制

动画播放过程中，可以使用键盘实时调整音高：

| 按键 | 功能 | 变化 |
|------|------|------|
| **W** | 升高八度 | +12半音 |
| **S** | 降低八度 | -12半音 |
| **A** | 降低音高 | -1半音 |
| **D** | 升高音高 | +1半音 |
| **SPACE** | 暂停/继续 | 切换播放状态 |

### 音高范围

- 最低：C2 (MIDI 36)
- 最高：C7 (MIDI 96)
- 调整范围：±24半音（2个八度）

---

## ❓ 常见问题

### Q1: 听不到声音

**A**: 需要设置MIDI输出设备

1. 运行测试：
   ```bash
   source venv/bin/activate
   python test_midi.py
   ```

2. 如果显示"没有找到MIDI设备"：
   - 安装SimpleSynth（推荐）
   - 或启用IAC Driver

3. 详细步骤见 `SOUND_SETUP_GUIDE.md`

### Q2: 声音很小/听不清

**A**: 可能原因：

1. **图片饱和度低**
   - 使用鲜艳、纯色的图片
   - 避免灰色调图片

2. **SimpleSynth音量**
   - 调高SimpleSynth的音量滑块

3. **系统音量**
   - 检查macOS系统音量设置

### Q3: 旋律听起来很混乱

**A**: 图片太复杂

- ✅ 使用：像素艺术、简单图案、纯色块
- ❌ 避免：复杂照片、细节过多的图片

### Q4: 程序运行很慢

**A**: 图片太大

- 当前像素块大小：80x80
- 大图片会生成很多音符
- 建议使用中小尺寸图片（<1000px）

### Q5: 如何调整像素块大小？

**A**: 编辑 `main.py`，修改第37行：

```python
self.pixel_size = 80  # 改为想要的大小
```

- 更小的值 = 更多像素块 = 更长的旋律
- 更大的值 = 更少像素块 = 更短的旋律

### Q6: 保存的MIDI文件无法播放

**A**: 确认：

1. 文件扩展名是 `.mid`
2. 使用支持MIDI的播放器
3. 尝试在GarageBand或QuickTime Player中打开

### Q7: 想要不同的音阶

**A**: 编辑 `melody_generator.py`，修改第33行：

```python
self.pentatonic_scale = [60, 62, 64, 67, 69, 72, 74, 76]
```

可以改为其他音阶，例如：
- 小调五声音阶：`[60, 63, 65, 67, 70, 72, 75, 77]`
- 完整大调音阶：`[60, 62, 64, 65, 67, 69, 71, 72]`

---

## 📚 相关文档

- `HSV_MELODY_GUIDE.md` - HSV色彩模型详解
- `SOUND_SETUP_GUIDE.md` - 声音设置完整指南
- `SOUND_TROUBLESHOOTING.md` - 声音问题解决
- `LATEST_UPDATE.md` - 最新功能说明
- `8BIT_MELODY_GUIDE.md` - 8-bit音乐特性

---

## 🎯 使用技巧

### 创造不同风格的旋律

**欢快明亮**
- 使用亮色（黄、白、浅蓝）
- 高饱和度
- 产生高音、强音量

**深沉稳重**
- 使用暗色（深蓝、深绿、黑）
- 高饱和度
- 产生低音、短音符

**柔和温柔**
- 使用中等明度
- 低饱和度（偏灰）
- 产生中音、弱音量

### 推荐测试图片

1. **彩虹渐变** - 展示完整音阶
2. **棋盘图案** - 节奏感强
3. **渐变圆形** - 平滑的旋律线
4. **像素艺术角色** - 复杂有趣的旋律

---

## 🔧 技术规格

- **语言**: Python 3.12
- **GUI**: Tkinter
- **图像处理**: Pillow (PIL)
- **音频**: pygame.midi
- **MIDI**: MIDIUtil
- **色彩**: colorsys (HSV转换)

---

## 📞 获取帮助

如果遇到问题：

1. 检查控制台输出的错误信息
2. 运行 `python test_midi.py` 测试MIDI
3. 查看相关文档（见上方）
4. 确认所有依赖已安装：`pip list`

---

**祝您玩得开心！** 🎨🎵✨

将您的创意图片转换为独特的8-bit音乐吧！
