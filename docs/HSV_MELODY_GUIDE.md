# HSV色彩模型 8-Bit旋律生成指南

## 🎨 色彩空间说明

### 什么是HSV？

**HSV** (Hue, Saturation, Value) 是一种更符合人类直觉的色彩模型：

- **H (Hue / 色相)**: 颜色的种类 - 红、橙、黄、绿、青、蓝、紫
- **S (Saturation / 饱和度)**: 颜色的纯度 - 鲜艳 vs 灰暗
- **V (Value / 明度)**: 颜色的亮度 - 明亮 vs 黑暗

### 为什么使用HSV而不是RGB？

RGB直接映射到音符会产生不自然的旋律，因为相近的颜色（如浅红和粉红）可能产生完全不同的音符。

HSV更适合音乐生成：
- 色相(H)形成自然的循环（色轮），就像音阶
- 饱和度(S)代表颜色的"强度"，对应音量
- 明度(V)代表亮暗，对应音高和时长

---

## 🎵 HSV → 音符映射规则

### 1. **色相 (Hue) → 音高**

色相值从0到1循环，就像色轮：
- `0.0` = 红色 → C (Do)
- `0.15` = 橙色 → D (Re)
- `0.3` = 黄色 → E (Mi)
- `0.5` = 青色 → G (Sol)
- `0.65` = 蓝色 → A (La)
- `0.8` = 紫色 → C (高八度)
- `1.0` = 红色 → C (循环回来)

**映射到五声音阶**: C, D, E, G, A（8-bit游戏音乐经典音阶）

```
色相 → 色轮位置 → 音符音高
```

### 2. **明度 (Value) → 八度 + 时长**

明度决定亮暗，影响音高和节奏：

**八度偏移**:
- `V > 0.7` (亮色) → 高八度 (+12半音)
- `0.4 < V ≤ 0.7` (中等) → 标准八度 (0)
- `V ≤ 0.4` (暗色) → 低八度 (-12半音)

**时长**:
- `V > 0.7` (亮色) → 1/4拍 (0.25) - 较长
- `0.4 < V ≤ 0.7` (中等) → 1/8拍 (0.125) - 标准
- `V ≤ 0.4` (暗色) → 1/16拍 (0.0625) - 短促

```
亮色 = 高音 + 长音符
暗色 = 低音 + 短音符
```

### 3. **饱和度 (Saturation) → 音量**

饱和度决定颜色的纯度，映射到音量：
- `S = 1.0` (纯色) → 高音量 (velocity 110)
- `S = 0.5` (中等) → 中音量 (velocity 80)
- `S = 0.0` (灰色) → 低音量 (velocity 50)

```
鲜艳颜色 = 强音量
灰色 = 弱音量
```

### 4. **Alpha (透明度) → 额外音量调节**

Alpha通道进一步调节最终音量：
- `A = 255` (不透明) → 保持原音量
- `A = 128` (半透明) → 音量减半
- `A = 0` (完全透明) → 静音

```
最终音量 = (饱和度音量) × (Alpha / 255)
```

---

## 🎨 颜色示例 → 音符效果

### 示例 1: 鲜红色
```
RGB(255, 0, 0) → HSV(0.0, 1.0, 1.0)
↓
色相0 → C (Do)
明度1 → 高八度 + 长音符
饱和度1 → 强音量
= 高音C，1/4拍，强音量
```

### 示例 2: 天蓝色
```
RGB(135, 206, 235) → HSV(0.55, 0.43, 0.92)
↓
色相0.55 → A (La)
明度0.92 → 高八度 + 长音符
饱和度0.43 → 中等音量
= 高音A，1/4拍，中音量
```

### 示例 3: 深绿色
```
RGB(0, 100, 0) → HSV(0.33, 1.0, 0.39)
↓
色相0.33 → E (Mi)
明度0.39 → 低八度 + 短音符
饱和度1.0 → 强音量
= 低音E，1/16拍，强音量
```

### 示例 4: 灰色
```
RGB(128, 128, 128) → HSV(0.0, 0.0, 0.5)
↓
色相0 → C (Do)
明度0.5 → 标准八度 + 标准音符
饱和度0 → 弱音量
= 中音C，1/8拍，弱音量
```

### 示例 5: 亮黄色
```
RGB(255, 255, 0) → HSV(0.17, 1.0, 1.0)
↓
色相0.17 → D (Re)
明度1.0 → 高八度 + 长音符
饱和度1.0 → 强音量
= 高音D，1/4拍，强音量
```

---

## 🎮 实际应用技巧

### 1. **创造旋律变化**
- 使用**色相渐变**（彩虹色）创造音阶上行/下行
- 使用**明度变化**创造高低音跳跃
- 使用**饱和度变化**创造音量渐强/渐弱

### 2. **8-Bit风格图片建议**
- ✅ **像素艺术**: 清晰的色块，鲜明对比
- ✅ **纯色图案**: 饱和度高，旋律明确
- ✅ **简单几何**: 重复图案产生节奏感
- ❌ **照片**: 颜色过于复杂，旋律混乱
- ❌ **低饱和度图**: 音量太小，难以听清

### 3. **颜色选择建议**

**明亮旋律** (高音，欢快):
- 使用亮色：黄色、青色、白色
- 高饱和度
- HSV: (any, >0.7, >0.7)

**深沉旋律** (低音，沉稳):
- 使用暗色：深蓝、深绿、深红
- 高饱和度
- HSV: (any, >0.7, <0.4)

**柔和旋律** (中音，温柔):
- 使用中等明度
- 低饱和度
- HSV: (any, <0.5, 0.4-0.7)

---

## 🎹 音阶参考

### 五声音阶（C大调）
```
C4  (60) - Do
D4  (62) - Re
E4  (64) - Mi
G4  (67) - Sol
A4  (69) - La
C5  (72) - Do (高八度)
D5  (74) - Re (高八度)
E5  (76) - Mi (高八度)
```

### 八度范围
- **低八度**: C2-A2 (36-45) - 深沉
- **标准**: C4-A4 (60-69) - 中等
- **高八度**: C5-A5 (72-81) - 明亮

---

## 💡 调试技巧

程序会输出调试信息（每10个像素）：
```
Note: RGB(255,200,100) → HSV(0.11,0.61,1.00) → Pitch=62, Vel=98
```

解读：
- RGB值
- HSV转换结果
- 最终音高（MIDI note number）
- 力度（velocity）

如果听不到声音，检查：
1. ✓ MIDI initialized successfully - 初始化成功
2. 音量是否太小（饱和度低）
3. 系统音量是否打开
4. 是否有MIDI输出设备

---

## 📁 保存功能

完成动画后：
- **[ SAVE MIDI ]** - 保存旋律为.mid文件
- **[ LOAD NEW ]** - 加载新图片

保存的MIDI文件可以在任何音乐软件中播放！

---

**享受基于色彩的音乐创作！** 🎨🎵✨
